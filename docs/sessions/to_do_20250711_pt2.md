# To-Do - 11/07/2025 (Parte 2)

## Objetivo da Sess√£o
Implementar sistema de monitoramento automatizado que processa dados di√°rios (CSV + XLSX) e executa todos os monitoramentos definidos nos JSONs de configura√ß√£o, gerando resultados estruturados e hist√≥rico acumulativo.

## Tarefas Identificadas

### üöÄ **Sistema de Monitoramento Automatizado**

1. **[üîÑ] Criar arquivo to_do da sess√£o**
   - Documentar objetivos e tarefas do dia
   - Incluir pend√™ncias anteriores relevantes

2. **[üìÅ] Estrutura de diret√≥rios para resultados**
   - Criar `/data/monitoring_results/`
   - Subdiret√≥rios por pool: `{pool_name}/`
   - Estrutura: resultados di√°rios + hist√≥rico acumulado

3. **[üéØ] Implementar monitoring_engine.py**
   - Orquestrador principal do sistema
   - Integra√ß√£o com data_loader existente
   - Modos: full (todos pools) ou espec√≠fico
   - Argumentos CLI: --pool, --date
   - Sistema de logging detalhado

4. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Subordina√ß√£o**
   - [ ] `check_excess_amortization()` - Verificar direito de amortiza√ß√£o excedente da s√©rie subordinada
   - [ ] `check_limit()` - Implementar valida√ß√£o de compliance com limites
   - [ ] `generate_result()` - Criar output JSON padronizado
   - [ ] `get_history()` - Implementar an√°lise temporal hist√≥rica
   - [ ] **Corrigir c√°lculo IS**: De `JR/PL` para `JR/(SR+JR)`
   - [ ] **Corrigir f√≥rmula de aporte**: Revisar matem√°tica financeira
   - [ ] **Refatorar arquitetura**: Separar responsabilidades seguindo SOLID
   - [ ] **Melhorar valida√ß√µes**: Casos edge, tipos, limites configurados

5. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Concentra√ß√£o**
   - `calc_concentracao_individual()` - Limite por entidade
   - `calc_concentracao_top_n()` - Limite agregado top N
   - `calc_concentracao_grupo_economico()` - Grupos econ√¥micos
   - `calc_concentracao_geral()` - Orquestrador

6. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Inadimpl√™ncia**
   - `calc_inadimplencia_30d()` - Atraso > 30 dias
   - `calc_inadimplencia_90d()` - Atraso > 90 dias
   - `calc_inadimplencia_geral()` - Consolidado

7. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Elegibilidade**
   - `calc_vencimento_medio()` - Prazo m√©dio ponderado
   - `calc_composicao_tipos_ativos()` - Tipos permitidos
   - `calc_sacados_elegiveis()` - Lista aprovada
   - `calc_valor_minimo()` - Valor m√≠nimo por ativo
   - `calc_vencimentos_individuais()` - Entre 7-180 dias
   - `calc_taxa_minima()` - M√≠nimo 150% CDI
   - `calc_registro_adequado()` - Verificar registros
   - `calc_criterios_elegibilidade()` - Consolidado

8. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Provis√µes**
   - `calc_pdd()` - Provis√µes por grupos (AA-H)
   - `calc_grupo_risco()` - Classificar por atraso
   - `calc_provisao_total()` - Somat√≥rio

9. **[‚öôÔ∏è] Implementar fun√ß√µes de c√°lculo - Operacional**
   - `calc_fundos_reserva()` - Reservas m√≠nimas
   - `calc_eventos_aceleracao()` - Detectar triggers
   - `calc_ordem_alocacao()` - Validar waterfall
   - `calc_investimentos_permitidos()` - Tipos aplica√ß√£o
   - `calc_conta_centralizadora()` - Movimenta√ß√£o
   - `calc_contas_vinculadas()` - Contas escrow
   - `calc_periodo_formacao()` - Regras 60 dias

10. **[üìä] Sistema de hist√≥rico e compara√ß√£o**
    - Arquivo `monitoring_history.json` acumulativo
    - Compara√ß√£o com √∫ltima execu√ß√£o
    - Detec√ß√£o de mudan√ßas de status
    - An√°lise de tend√™ncias

11. **[‚úÖ] Testes com pool piloto**
    - Usar LeCapital Pool #1
    - Validar c√°lculos vs Excel
    - Verificar gera√ß√£o de arquivos
    - Expandir para outros pools

12. **[üìù] Atualizar documenta√ß√£o**
    - PRD: Se√ß√£o "Monitoramento Automatizado"
    - CLAUDE.md: Nova arquitetura
    - Sincronizar m√©tricas

## Estrutura JSON de Sa√≠da

```json
{
  "pool_id": "LeCapital Pool #1",
  "data_monitoramento": "2025-01-11",
  "monitoramentos": {
    "[evento_id]": {
      "valor_calculado": 0.287,
      "limites": {...},
      "status": "ENQUADRADO|DESENQUADRADO|ALERTA",
      "margem": 0.037,
      "mensagem": "Descri√ß√£o clara do resultado"
    }
  },
  "resumo": {
    "total_monitoramentos": 7,
    "enquadrados": 5,
    "desenquadrados": 2,
    "eventos_criticos": []
  },
  "comparacao_temporal": {
    "mudancas_status": {...}
  }
}
```

## Status
- **Sess√£o**: 11/07/2025 (Parte 2)
- **Foco**: Sistema completo de monitoramento automatizado
- **Meta**: 24+ fun√ß√µes implementadas, testadas com 2+ pools
- **Progresso**: 0/12 tarefas

## Ordem de Implementa√ß√£o
1. Estrutura base + engine
2. Monitor subordina√ß√£o (mais simples)
3. Monitor concentra√ß√£o (mais complexo)
4. Completar demais monitores
5. Sistema hist√≥rico
6. Testes e valida√ß√£o

## Pr√≥ximos Passos
- Ap√≥s conclus√£o, expandir para 44 pools
- Implementar monitores customizados
- Dashboard executivo
- Alertas autom√°ticos